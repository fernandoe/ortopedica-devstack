version: "3"

services:
  mysql:
    container_name: ortopedica.mysql
    image: mysql:5.7.21
    volumes:
      - mysql-data:/var/lib/mysql
    restart: always
    ports:
      - "3306:3306"
    environment:
      MYSQL_ROOT_PASSWORD: password

  conta:
    container_name: ortopedica.conta
    image: fernandoe/fe-conta-server:local
    ports:
      - "9000:8000"
    volumes:
      - ../fe-conta-server/src:/app
    depends_on:
      - mysql
    environment:
      DJANGO_SETTINGS_MODULE: 'server.settings.docker'
      DATABASE_URL: mysql://root:password@mysql:3306/conta
      no_proxy: mysql
    stdin_open: true
    tty: true

  pessoa:
    container_name: ortopedica.pessoa
    image: fernandoe/fe-pessoa-server:local
    ports:
      - "9001:8000"
    volumes:
      - ../fe-pessoa-server/src:/app
    depends_on:
      - mysql
      - conta
    environment:
      DJANGO_SETTINGS_MODULE: 'server.settings.docker'
      DATABASE_URL: mysql://root:password@mysql:3306/pessoa
      no_proxy: mysql,conta
    stdin_open: true
    tty: true

  endereco:
    container_name: ortopedica.endereco
    image: fernandoe/fe-endereco-server:local
    ports:
      - "9002:8000"
    volumes:
      - ../fe-endereco-server/src:/app
    depends_on:
      - mysql
      - conta
    environment:
      DJANGO_SETTINGS_MODULE: 'server.settings.docker'
      DATABASE_URL: mysql://root:password@mysql:3306/endereco
      no_proxy: mysql,conta
    stdin_open: true
    tty: true

  ortopedica:
    container_name: ortopedica
    build:
      context: ../ortopedica
      dockerfile: Dockerfile.devenv.dockerfile
    ports:
      - "4200:4200"
    volumes:
      - ../ortopedica:/app

volumes:
  mysql-data:
